<% include partials/head.ejs %>

<header class="header-section header-section-score">
  <div class="nav">
    <a href="/games"><img class="back-btn" src="/img/arrow.svg"></a>   
    <h3>Game Overview</h3>
  </div>

  <section class="header-section--score">
    <div class="team team-1">
      <h3><%= game.team_1.name %></h3>
    </div>

    <div class="game-score">
      <h3><%= team1Score %> - <%= team2Score %></h3>
    </div>

    <div class="team team-2">
      <h3><%= game.team_2.name %></h3>
    </div>

    <div class="update-login-btn">
    <% if (accessToken) { %>
      <a href="#lightbox">Update Score</a>
    <% } else { %>
      <a href="/login">Log in</a>
    <% } %> 
    </div>
  </section>

  <section class="header-section--info">
      <div>
        <p> <%= h.moment(game.start_time).format('MMMM Do YYYY') %> at <%= new Date(game.start_time).toString().substr(15,6) %> </p>
      </div>

      <div>
        <p> <%= game.game_site.name %> </p>
      </div>
  </section>
</header>

<section class="game-updates">
  <h2><%= game.tournament.name %> - Round <%= game.swiss_round.round_number %></h2>  
  <p><b>Last update:</b> <%= h.moment(game.time_last_updated).format('MMMM Do YYYY') %> at <%= new Date(game.time_last_updated).toString().substr(15,6) %> </p>

  <ul class="">
    <li>
    <!-- Show pop up message after user updates game -->
    <% if(locals.flashes) { %>
      <% var categories =  Object.keys(flashes); %>
      <% categories.forEach(function (cat) { %>
        <% flashes[cat].forEach(message => { %>
          <section class="flash-message boxshadow"> 
            <button id="close-message">close</button>
            <h2>Score Updated!</h2>
            <p><%= message %></p> 
          </section>
        <% }) %>
      <% }) %>
    <% } %>
    </li>
    <li>
      <h3> Team 1 scored ! </h3>  
      <p><%= h.moment(game.time_last_updated).format('MMMM Do YYYY') %> at <%= new Date(game.time_last_updated).toString().substr(15,6) %></p>  
    </li>

    <li>
      <h3> Team 2 scored !</h3>    
      <p><%= h.moment(game.time_last_updated).format('MMMM Do YYYY') %> at <%= new Date(game.time_last_updated).toString().substr(15,6) %></p>
    </li>
  </ul>

</section>

<section class="score-update" id="lightbox">
  <div>
    <a href="/update/<%= game.id %>"><img class="close-btn" src="/img/close.svg"></a>      
    <h3>Update Score</h3>
  </div>
  
  <form action="/update_score" method="post" class="form-scoreboard">
    <fieldset class="scoreboard">
      <label for="team1_score">
        <%= game.team_1.name %>:
        <input type="number" name="team1_score" value="<%= team1Score %>" max="30" id="score-team1" class="scoreboard-team">
        <button class="add-score add-score1" type="button"><img class="add-score1" src="/img/plus.svg"></button>
      </label>

      <label for="team2_score">
        <%= game.team_2.name %>:
        <input type="number" name="team2_score" value="<%= team2Score %>" max="30" id="score-team2" class="scoreboard-team">
        <button class="add-score add-score2" type="button"><img class="add-score2" src="/img/plus.svg"></button>
      </label>
    </fieldset>

    <fieldset class="score-info">
      <label for="final-score">
        final score?
        <input type="checkbox">
      </label>

      <input type="hidden" name="game_id" value="<%= game.id %>">
      <input type="hidden" name="team_1" value="<%= game.team_1.name %>">
      <input type="hidden" name="team_2" value="<%= game.team_2.name %>">

      <input type="submit" value="update score" class="action-button">
    </fieldset>
  </form> 
</section>

<% include partials/footer.ejs %>
