<% include partials/head.ejs %>

<header class="boxshadow">
  <div class="header-section">
    <h2><%= tournamentLong %></h2>
  </div>

  <div class="header-tabs">
    <ul>
      <li class="active"><a href="#">Games</a></li>
      <li class=""><a href="/swiss-standings/<%= games[0].swiss_round_id %>">Rankings</a></li>
    </ul>
  </div>
</header>

<div class="division-select">
  <a href="/games"><button <% if(tournamentShort === 'Mixed') { %> class="active" <% } %>>Mixed</button></a>
  <a href="/games/19747"><button <% if(tournamentShort === 'Women') { %> class="active" <% } %>>Women</button></a>
  <a href="/games/19746"><button  <% if(tournamentShort === 'Open') { %> class="active" <% } %>>Open</button></a>
</div>

<!-- Show pop up message after user updates game -->
<% if(locals.flashes) { %>
  <% var categories =  Object.keys(flashes); %>
  <% categories.forEach(function (cat) { %>
    <% flashes[cat].forEach(message => { %>
      <div class="flash-message boxshadow"> 
        <button class="close">close</button>
        <h2>Score Updated!</h2>
        <p><%= message %></p> 
      </div>
    <% }) %>
  <% }) %>
<% } %>

<section class="team-games">
    <h2>Games</h2>
    <ul class="gameslist">
      <% games.forEach(function (obj) { %>
      <li class="boxshadow">
        <p class="tournament-info">ROUND <%= obj.swiss_round.round_number %> - @<%= obj.tournament.name %></p>
        <a href="/update/<%= obj.id %>">

          <div class="team1">
            <h3 <% winners.forEach( function(winner) { if (winner.short_name === obj.team_1.short_name) { %> class="game-winner" <% }}) %>>
              <%= obj.team_1.short_name %>
            </h3>
            <h4><span><%= obj.team_1_score %></span></h4>
          </div>

          <div class="info">
            <p> <b><%= h.moment(obj.start_time).format('dddd Do') %></b></p>
            <p> <b><%= new Date(obj.start_time).toString().substr(15,6) %></b></p>
          </div>

          <div class="team2">
            <h3 <% winners.forEach( function(winner) { if (winner.short_name === obj.team_2.short_name) { %> class="game-winner" <% }}) %>>
              <%= obj.team_2.short_name %>
            </h3>
            <h4><span><%= obj.team_2_score %></span></h4>
          </div>

        </a>
        <% if (obj.game_site.name) { %>
        <p class="game-location"><%= obj.game_site.name %></p>
        <% } %>
      </li>
      <% }) %>
    </ul>

</section>

<% include partials/footer.ejs %>
